Title: Breaking changes

----

Text:

#### Core

- Kirby requires at least PHP 8.2
- Data/variables from your `site` controller will now be passed to all templates [#6412](https://github.com/getkirby/kirby/pull/6412)
- Users without a role in their credentials file will now receive the `default` role (if exists), not the `visitor` role anymore [#6656](https://github.com/getkirby/kirby/pull/6656)
- Model action `before` hooks: rules get applied after the hook runs
- If file sorting was previously disabled via the `files.update` permission, the new `file.sort` permission has to be configured accordingly. [#6589](https://github.com/getkirby/kirby/pull/6589)
- PHP (return) type hints have been added to many collection methods. If you are extending Core classes, you might need to add the same to your own classes and methods.
- `Image\Dimensions::forImage()` now receives an `Image\Image` object [#6591](https://github.com/getkirby/kirby/pull/6591)
- `Image\Exif::read()` is now a static method that receives an absolute path to a file [#6591](https://github.com/getkirby/kirby/pull/6591)
- Thumb driver `autoOrient` option has been removed and now is always applied [#6591](https://github.com/getkirby/kirby/pull/6591)
- `Str::camel()`, `Str::camelToKebab()`, `Str::float()`, `Str::kebab()`, `Str::kebabToCamel()`, `Str::length()`, `Str::lower()`, `Str::safeTemplate()`, `Str::short()`, `Str::slug()`, `Str::snake()`, `Str::studly()`, `Str::substr()`, `Str::template()`, `Str::ucfirst()`, `Str::ucwords()`, `Str::unhtml()`, `Str::upper()` and `Str::widont()` can no longer be called without a value argument (passing a `null` value still works) [#6401](https://github.com/getkirby/kirby/pull/6401)
- All content storage methods must now use the `VersionId` instead of a simple string. [#6436](https://github.com/getkirby/kirby/pull/6436)
- All methods in `*Rules` classes are now marked to return void instead of a boolean [#6660](https://github.com/getkirby/kirby/pull/6660)

#### Panel

- Kirby 5 requires the following browser versions to use the Panel (other browser requirements remain unchanged)
    - Safari 16+
    - Mobile Safari 16+
    - Android Browser 126+
    - Chrome for Android 126+
- Panel uploads can exceed the `upload_max_filesize` limit [#6421](https://github.com/getkirby/kirby/pull/6421)
    - If you want to restrict the upload size, please use the file blueprint (link: docs/reference/panel/blueprints/file#accept text: `accept` `maxsize` option)
- Calendar dropdown input will show Sunday now as first day of the week (depending on the user's language). If you want to enforce Monday as first day of the week, you can set the `date.weekday` option to `1`. [#6635](https://github.com/getkirby/kirby/pull/6635)
- `<k-form>` and `<k-fieldset>` as well as many fields and inputs don't emit an `invalid` event anymore. Use native HTML invalid state of elements instead. [#6099](https://github.com/getkirby/kirby/pull/6099)
- `novalidate` prop has been removed from all elements but `<k-form>` [#6099](https://github.com/getkirby/kirby/pull/6099)
- Removed `hasErorrs` methods of `k-fieldset` [#6173](https://github.com/getkirby/kirby/pull/6173)
- `<k-file-preview>` got fully refactored. If you were replacing or extending it, your code likely will break. Check out the new custom file preview feature if you want to provide previews for specific files. [#6578](https://github.com/getkirby/kirby/pull/6578)
- Select field: `empty` prop was removed. Use combination of `required`, `placeholder` and `default` to replicate functionality [#6459](https://github.com/getkirby/kirby/pull/6459)
- While `<k-writer>` is still included as alias for <`k-writer-input`>, some use cases where you accessed the `<k-writer>` component via the `$refs` of `<k-writer-input>` have to be adapted [#6172](https://github.com/getkirby/kirby/pull/6172)
- `<k-draggable>`: the `move` callback function is receiving an event with an altered data structure
- CSS attribute selectors must be written fully qualified (e.g. `[data-hidden="true"]` as only `[data-hidden]` can start matching also elements where that attribute is `false`) [#6109](https://github.com/getkirby/kirby/pull/6109)

#### Removed deprecated code

| Removed | Use instead |
| --- | --- |
| `<k-aspect-ratio>`  | `<k-frame>` |
| `<k-autocomplete>` | - |
| `<k-bar>`: `left`, `right` and `center` slots  | default slot |
| `<k-breadcrumb>`: `view prop` | Add as first entry to crumbs prop |
| `<k-button>`: `tooltip` prop | `title` prop |
| `<k-button-disabled>` | `<k-button :disabled="true">` |
| `<k-button-link>`  | `<k-button link="...">` |
| `<k-button-native>` | `<k-button>` |
| `<k-dialog>`:  `disabled`, `icon` and `theme` props. | `submit-button` prop |
| `<k-dropdown>` | `<k-dropdown-content>` as standalone |
| `<k-grid>`: `gutter` prop | `style="gap: "` or `variant` prop |
| `<k-header>`: `left` and `right` slots | `buttons` slot  |
| `<k-header>`: `tabs` prop |  standalone `<k-tabs>` |
| `<k-headline>`: `size` prop | `tag` prop |
| `<k-headline>`: `theme` prop | - |
| `<k-icon>`: removed support for other viewBox than `0 0 24 24` |	Wrap icon in an `<svg>` element with corresponding viewBox attribute |
| `<k-inside>` | `<k-panel-inside>` |
| `<k-loader>` | `<k-icon type="loader" />`  |
| `<k-outside>` | `<k-panel-outside>` |
| `<k-plugin-view>`  | - |
| `<k-progress>`: `set` method | `value` prop |
| `<k-text>`: `theme` prop  | - |
| `<k-upload>` | `$panel.upload module` |
| `<k-view>` | - |
| `$store.drawer`  | `$panel.drawer`  |
| `$store.notification` | `$panel.notification` |
| `$store.dialog()` | `$panel.dialog.open()` |
| `$store.drag()` | `$panel.drag.start(type, data)` |
| `$store.fatal()` | `$panel.notification.fatal()` |
| `$store.isLoading()` | `$panel.isLoading` |
| `$store.navigate()` | - |
| JS `$events.$on`, `$events.$off`, `$events.$emit` | `$events.on`, `$events.off`, `$events.emit` |
| `Array.wrap()` | `this.$helper.array.wrap()` |
| `Array.fromObject()` | `this.$helper.array.fromObject()` |
| `myArray.split()` | `this.$helper.array.split(myArray, delimiter)` |
| `myArray.sortBy()` | `this.$helper.array.sortBy(myArray, sortBy)` |
| `Kirby\Cms\Model` | - |
| `Kirby\Cms\Properties` trait | PHP native named properties |
| `Kirby\Cms\File::contentFileDirectory()` | - |
| `Kirby\Cms\File::contentFileName()` | - |
| `Kirby\Cms\ModelWithContent::contentFile()` | `$model->storage()->contentFile()` |
| `Kirby\Cms\ModelWithContent::contentFiles()` | `$model->storage()->contentFiles()` |
| `Kirby\Cms\ModelWithContent::contentFileDirectory()` | - |
| `Kirby\Cms\ModelWithContent::contentFileName()` | - |
| `Kirby\Cms\ModelWithContent::contentFileExtension()` | - |
| `Kirby\Cms\Page::contentFileName()` | - |
| `Kirby\Cms\Site::contentFileName()` | - |
| `Kirby\Cms\User::contentFileName()` | - |